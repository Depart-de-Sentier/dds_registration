{% extends "base.html" %}

{% block heading_action %}OneEvent!{% endblock %}
{% block heading_title %}All ASL events{% endblock %}


{% block content %}

<div class="row"><div class="table-responsive">
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Event</th>
                <th>Date</th>
                <th>Infos</th>
                <th>Organised by</th>
                {% if user.is_authenticated %}
                <th><!--  Actions --></th>
                {%endif%}
            </tr>
        </thead>
        <tbody>
            {% for event_info in events %}
            <tr>
                <td>
                    <p>{{ event_info.event.title }}</p>
                    {% if event_info.event.location_name %}<p><small>at </small>{{event_info.event.location_name}}</p>{% endif %}
                </td>
                <td><p>{{ event_info.event.start|date:"D, d N Y H:i" }}</p>
                    {% if event_info.event.end %}<p>- {{ event_info.event.end|date:"D, d N Y H:i" }}</p>{% endif %}
                </td>
                <td>
                    {% if event_info.event.booking_close %}
                    <p>Registration closes: {{event_info.event.booking_close|date:"D, d N Y H:i e"}}</p>
                    {% endif %}
                    {% if event_info.event.choices_close %}
                    <p>Choices closes: {{event_info.event.choices_close|date:"D, d N Y H:i e"}}</p>
                    {% endif %}
                    {% if event_info.event.price_for_employees > 0.0 or event_info.event.price_for_employees > 0.0 %}
                    <p>Price for Employees: {{ event_info.event.price_for_employees }}{% if event_info.event.price_currency %}({{event_info.event.price_currency}}){% endif %}</p>
                    <p>Price for Contractors: {{ event_info.event.price_for_contractors }}{% if event_info.event.price_currency %}({{event_info.event.price_currency}}){% endif %}</p>
                    {% endif %}
                </td>
                <td>{% for orga in event_info.event.organisers.all %}<p>{{orga.get_full_name}}</p>{% endfor %}</td>
                {% if user.is_authenticated %}
                <td>
                {% if event_info.booking %}
                    {% if event_info.event.is_choices_open %}
                    <a href="{% url 'update_booking' booking_id=event_info.booking.id %}" class="btn btn-success">Choices</a>
                    {% else %}
                    <button type="button" class="btn btn-success disabled enable-tooltip"
                        data-toggle="tooltip" data-placement="top" title="Too late Vicky! ;-)">Choices Closed</button>
                    {% endif %}
                    {% if event_info.event.is_booking_open %}
                    <a href="{% url 'cancel_booking' booking_id=event_info.booking.id %}" class="btn btn-danger">Unregister</a>
                    {% else %}
                    <button type="button" class="btn btn-danger disabled enable-tooltip"
                        data-toggle="tooltip" data-placement="top" title="Too late Vicky! ;-)">Event Closed</button>
                    {% endif %}
                {% elif event_info.event.is_booking_open %}
                    <a href="{% url 'create_booking' event_id=event_info.event.id %}" class="btn btn-info">Register !</a>
                {% else %}
                    <button type="button" class="btn btn-info disabled enable-tooltip"
                        data-toggle="tooltip" data-placement="top" title="Too late Vicky! ;-)">Event Closed</button>
                {% endif %}
                {% if user in event_info.event.organisers.all or user.is_superuser %}
                    <a href="{% url 'manage_event' event_id=event_info.event.id %}" class="btn btn-default">Manage</a>
                {% endif %}
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div></div>

{% endblock %}
